<template>
    <element-border :height="260">
        <p class="p-component">寿命预测</p>
        <el-row>
            <el-col id="VehicleSecondLifeChart" style="height: 220px"></el-col>
        </el-row>
    </element-border>
</template>

<script>
import {lifePredict} from "@/assets/js/chart";
import {wsBLE} from "@/api/consumer-ws";
import {JSONData} from "@/api/websocket-util";
import {mapActions} from "vuex"

export default {
    name: "VehicleSecondLifeChart",
    data() {
        return {
            ws: null,
            id: this.$route.params.id,
            data: {
                better_life: 99.45,
                data: [[449.0, 107.0], [463.0, 107.0], [477.0, 108.0], [499.0, 111.0], [3322.0, 111.0], [3400.0, 107.0], [5234.0, 110.0], [5235.0, 110.0], [5738.0, 110.0], [6589.0, 110.0], [6611.0, 110.0], [6877.0, 110.0], [10660.0, 110.0], [14548.0, 110.0], [15591.0, 110.0], [16121.0, 110.0], [16704.0, 111.0], [16712.0, 110.0], [17006.0, 110.0], [17030.0, 110.0], [19692.0, 108.0], [20142.0, 110.0], [21884.0, 107.0], [22709.0, 110.0], [23540.0, 110.0], [23595.0, 110.0], [23603.0, 110.0], [24413.0, 110.0], [24895.0, 110.0], [25757.0, 110.0], [26860.0, 110.0], [28281.0, 110.0], [28469.0, 110.0], [28539.0, 110.0], [28585.0, 110.0], [31224.0, 107.0], [31272.0, 108.0], [31273.0, 108.0], [32581.0, 110.0], [34965.0, 110.0], [38198.0, 110.0], [40093.0, 110.0], [40339.0, 110.0], [41289.0, 110.0], [41662.0, 110.0], [42586.0, 110.0], [44411.0, 110.0], [45528.0, 107.0], [46567.0, 110.0], [51496.0, 110.0], [51511.0, 110.0], [51517.0, 110.0], [51523.0, 110.0], [51529.0, 110.0], [51533.0, 110.0], [51539.0, 110.0], [51561.0, 110.0], [51567.0, 110.0], [51577.0, 110.0], [53288.0, 109.0], [53330.0, 109.0], [53348.0, 109.0], [53397.0, 107.0], [53405.0, 108.0], [53420.0, 109.0], [54257.0, 110.0], [56459.0, 110.0], [56695.0, 111.0], [56743.0, 110.0], [56745.0, 110.0], [56750.0, 110.0], [57306.0, 110.0], [57783.0, 110.0], [58613.0, 108.0], [58929.0, 109.0], [61172.0, 110.0], [62100.0, 109.0], [62950.0, 110.0], [64019.0, 110.0], [64023.0, 110.0], [64031.0, 110.0], [64800.0, 110.0], [65029.0, 110.0], [69533.0, 110.0], [74384.0, 111.0], [74539.0, 110.0], [74746.0, 110.0], [76228.0, 110.0], [78066.0, 110.0], [78276.0, 110.0], [80442.0, 110.0], [80663.0, 110.0], [81859.0, 110.0], [82668.0, 110.0], [85450.0, 110.0], [86546.0, 110.0], [88107.0, 108.0], [88115.0, 108.0], [88242.0, 108.0], [89341.0, 110.0], [90709.0, 110.0], [90922.0, 110.0], [94029.0, 110.0], [94908.0, 110.0], [95158.0, 108.0], [96066.0, 110.0], [96198.0, 108.0], [97357.0, 108.0], [97684.0, 108.0], [98209.0, 110.0], [98339.0, 110.0], [98654.0, 108.0], [99870.0, 108.0], [101100.0, 108.0], [102220.0, 108.0], [108290.0, 108.0], [109231.0, 108.0], [109232.0, 108.0], [109767.0, 108.0], [111072.0, 109.0], [111073.0, 109.0], [111916.0, 108.0], [114085.0, 108.0], [116600.0, 109.0], [116989.0, 110.0], [117347.0, 108.0], [117926.0, 109.0], [118745.0, 108.0], [119808.0, 108.0], [123197.0, 108.0], [124115.0, 108.0], [125307.0, 108.0], [126311.0, 109.0], [126546.0, 109.0], [126547.0, 109.0], [126958.0, 110.0], [127168.0, 108.0], [127186.0, 110.0], [127206.0, 110.0], [127242.0, 110.0], [131029.0, 108.0], [134759.0, 110.0], [134760.0, 110.0], [134762.0, 110.0], [134763.0, 110.0], [134940.0, 110.0], [136094.0, 110.0], [138098.0, 110.0], [139698.0, 110.0], [140579.0, 108.0], [141859.0, 108.0], [145349.0, 109.0], [145379.0, 109.0], [146497.0, 108.0], [148027.0, 108.0], [148899.0, 108.0], [150020.0, 108.0], [152959.0, 108.0], [153925.0, 108.0], [155383.0, 110.0], [155899.0, 108.0], [156146.0, 108.0], [157412.0, 108.0], [158483.0, 110.0], [159622.0, 110.0], [159966.0, 110.0], [168009.0, 108.0], [169018.0, 108.0], [169643.0, 108.0], [170520.0, 110.0], [173343.0, 108.0], [173344.0, 108.0], [173410.0, 108.0], [173454.0, 108.0], [175913.0, 108.0], [176740.0, 108.0], [177512.0, 108.0], [178659.0, 108.0], [179782.0, 109.0], [183427.0, 108.0], [184777.0, 108.0], [185270.0, 108.0], [186515.0, 108.0], [190204.0, 108.0], [192347.0, 108.0], [193555.0, 108.0], [195689.0, 108.0], [196101.0, 108.0], [201840.0, 108.0], [201884.0, 108.0], [201912.0, 108.0], [202279.0, 108.0], [203935.0, 108.0], [205884.0, 108.0], [206029.0, 108.0], [206082.0, 110.0], [206796.0, 109.0], [207719.0, 110.0], [209609.0, 108.0], [209873.0, 108.0], [217468.0, 110.0], [217651.0, 110.0], [217669.0, 110.0], [220053.0, 110.0], [220618.0, 110.0], [222130.0, 110.0], [222778.0, 110.0], [223044.0, 110.0], [224562.0, 110.0], [225953.0, 110.0], [227057.0, 110.0], [227799.0, 110.0], [228206.0, 110.0], [230934.0, 110.0], [232016.0, 110.0], [232261.0, 110.0], [233730.0, 110.0], [235368.0, 110.0], [237912.0, 110.0], [237934.0, 110.0], [237958.0, 110.0], [238049.0, 110.0], [238867.0, 110.0], [240089.0, 110.0], [241021.0, 110.0], [242105.0, 109.0], [246346.0, 110.0], [246347.0, 110.0], [246365.0, 110.0], [246366.0, 110.0], [247443.0, 110.0], [247444.0, 110.0], [247446.0, 110.0], [247447.0, 110.0], [249522.0, 108.0], [250073.0, 110.0], [250514.0, 110.0], [250812.0, 110.0], [251431.0, 110.0], [251455.0, 110.0], [252234.0, 110.0], [253892.0, 110.0], [256176.0, 110.0], [256301.0, 110.0], [256489.0, 110.0], [257021.0, 110.0], [258595.0, 110.0], [258818.0, 108.0], [259348.0, 108.0], [260161.0, 108.0], [260461.0, 108.0], [261114.0, 110.0], [262586.0, 108.0], [264427.0, 110.0], [264548.0, 110.0], [264668.0, 110.0], [265198.0, 110.0], [265916.0, 110.0], [266615.0, 110.0], [266783.0, 110.0], [267050.0, 110.0], [267191.0, 110.0], [268225.0, 110.0], [269977.0, 108.0], [270733.0, 108.0], [272352.0, 110.0], [272766.0, 110.0], [272958.0, 110.0], [273151.0, 110.0], [273412.0, 110.0], [274580.0, 109.0], [275032.0, 108.0], [275774.0, 108.0], [276032.0, 108.0], [277368.0, 108.0], [278649.0, 108.0], [280153.0, 108.0], [280819.0, 110.0], [280831.0, 110.0], [281009.0, 110.0], [281208.0, 110.0], [281856.0, 110.0], [282070.0, 110.0], [282193.0, 110.0], [282293.0, 108.0], [283101.0, 110.0], [284288.0, 108.0], [284554.0, 109.0], [287157.0, 108.0], [291035.0, 108.0], [291298.0, 110.0], [292000.0, 110.0], [293209.0, 108.0], [293613.0, 110.0], [293614.0, 110.0], [293708.0, 110.0], [293766.0, 110.0], [293876.0, 108.0], [294022.0, 108.0], [294023.0, 108.0], [294195.0, 109.0], [294196.0, 109.0], [294222.0, 108.0], [296442.0, 108.0], [297546.0, 108.0], [298213.0, 110.0], [298356.0, 110.0], [298906.0, 110.0], [299376.0, 110.0], [299899.0, 110.0], [299972.0, 110.0], [300101.0, 110.0], [300899.0, 110.0], [303407.0, 108.0]],
                y_min: 106.0,
                x_max: 303438,
                y_max: 112.0,
                x_min: 418
            },
        }
    },
    created() {
        this.initWs();
    },
    mounted() {
        this.receiveData();
    },
    unmounted() {
        this.ws.close();
    },
    methods: {
        ...mapActions(["actionVehicleLife"]),
        initWs() {
            this.ws = this.$ws(wsBLE(this.id))
        },
        receiveData() {
            const that = this;
            that.drawLine();
            that.ws.onmessage = (data) => {
                let result = JSONData(data).data;
                if (result) {
                    that.data = result;
                    that.actionVehicleLife(this.data.better_life);
                }
                that.actionVehicleLife(0);
                this.drawLine();
            }
        },
        drawLine() {
            let chart = this.$chart.init(document.getElementById("VehicleSecondLifeChart"));
            lifePredict(chart, this.data);
            setTimeout(() => {
                window.onresize = () => {
                    chart.resize();
                };
            }, 200);
        }
    }
}
</script>

<style scoped>

</style>
